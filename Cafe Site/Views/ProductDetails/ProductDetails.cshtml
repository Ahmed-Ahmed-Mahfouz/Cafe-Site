@{
    Layout = "~/Views/Shared/_CustomProductDetailsLayout.cshtml";
}
@model ProductDetailsModel



<link href="~/css/all.css" rel="stylesheet" />
<style>
    .add:hover
    {
        cursor:pointer;
    }
</style>
<!--header start-->
<header id="fh5co-header" class="fh5co-cover js-fullheight" role="banner" style="background-image: url('/images/hero_1.jpeg'); height: 702px; background-position: 0px 0px;" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <div class="display-t js-fullheight" style="height: 702px;">
                    <div class="display-tc js-fullheight animate-box fadeIn animated-fast" data-animate-effect="fadeIn" style="height: 702px;">
                        <h1>Product Details</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
<!--header end-->
<!--  alert start -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog ">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Alert</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-black">
                The product is added to cart
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<!--  alert end -->
<div class="product-details row p-3 d-flex flex-row ">
    <!--product img start-->
    <div class="prodimg col-md-6">
        <div class="row w-100 d-flex flex-row justify-content-center">
            <div class="col">
                <img class="prodImg img-responsive w-100 mb-5 p-5" src="data:image/png;base64,@Convert.ToBase64String(Model.Product.Product_Image ?? new byte[0])" alt="...">

            </div>
        </div>
    </div>
    <!--product img end-->

        <div class="col-md-6 d-flex flex-column align-items-center align-items-md-start ">  
                <h1 class="name text-white-50" >@Model.Product.Product_Name</h1>

                <h4 class="price font-monospace"
                    style="color: #BE9C79;">
                        @Model.productSizePrices[Model.productSizePrices.Count-1].Price.ToString("0.00") $
                </h4>
                <!--size start-->
                <p class="size fw-bolder" style=" color: #BE9C79;">
                    Size: <span class="fw-light text-white-50">
                        <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                            @for (var i = 0; i < Model.productSizePrices.Count; i++)
                            {
                                <input id="sizeInput" type="radio" class="btn-check" name="size" value="@Model.productSizePrices[i].Size" id="btnradio @(i+1)" autocomplete="off" checked>
                                <label class="sizeLabel btn btn-outline-light" for="btnradio @(i+1)">@Model.productSizePrices[i].Size</label>
                            }

                        </div>
                    </span>
                </p>
                <!--size end-->
                <!--addToCard start-->
                <div class="addToCardBtn row">
                    <div class="col-12">
                        <button  class="addToCart btn p-3 h-100 text-white border-0 rounded-2" data-bs-toggle="modal" data-bs-target="#exampleModal" type="submit" name="product" value="@Model.Product.Product_Id" style="background-color: #BE9C79;">ADD TO CART</button>
                    </div>
                </div>
            
                <!--addToCard end-->
                <!--Tabs start-->
                <nav class="tabs mt-5">
                    <div class="nav nav-tabs " id="nav-tab" role="tablist">
                        <button class="nav-link active px-5 fs-3 " style="color:#BE9C79" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Description</button>
                        <button class="nav-link px-5 fs-3" id="nav-profile-tab" style="color:#BE9C79" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Additions</button>
                        <button class="nav-link px-5 fs-3" id="nav-contact-tab" style="color:#BE9C79" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false">Review</button>
                    </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    <!--description start-->
                    <div class="Desc tab-pane fade show active text-white-50" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab" tabindex="0">
                        <p class="desc_website text-center text-md-start text-white-50 mt-4">Our website is designed to make your shopping experience as smooth and enjoyable as possible. You can browse by category, color, size, or brand, and filter your search results to find exactly what you’re looking for. We offer free shipping on orders over a certain amount and easy returns if you’re not completely satisfied with your purchase.</p>

                    </div>
                    <!--description end-->
                    <!--Additions start-->
                    <div class="Adds tab-pane fade p-2" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab" tabindex="0">
                        <div class="row w-100">
                            <label class="fs-4 mt-3 ">Choose Additions</label>
                           
                        </div>
                        <div class="row d-flex flex-row justify-content-around ">
                            <div class="cartproducts col">
                                @for(int i=0; i<Model.AddProducts.Count; i++)
                                {
                                    <div class="addedprod row " id="@Model.AddProducts[i].Product_Id">
                                       
                                        <div class="col-3 d-flex flex-row justify-content-between align-items-center ">
                                            <img class="prodImg w-100 h-75 rounded-circle " src="/images/whipped-cream-1.jpg" style="aspect-ratio:1/1" alt="...">
                                        </div>
                                        <div class="col-4 d-flex flex-row justify-content-between align-items-center">
                                            <h6 class="prodName text-white mb-0">@Model.AddProducts[i].Product_Name</h6>
                                        </div>
                                        <div class="col-2 d-flex flex-row justify-content-between align-items-center">
                                            <h6 class="prodPrice fs-4 font-monospace mb-0 " style="color:#BE9C79">@Model.AddProducts[i].Product_Size_Prices[0].Price</h6>
                                        </div>
                                         <div class="col-2 d-flex flex-row justify-content-between align-items-center align-self-center ms-5 ms-sm-0 mb-3 mb-sm-0">
                                            <input class="additions d-inline w-auto invisible " id=@i name="productAdds" value="@Model.AddProducts[i].Product_Id" type="checkbox" />
                                            <label class="add d-inline w-auto" for=@i><i class="fa-regular fa-square-plus fa-xl" style="color: #1d9d1b;"></i></label>
                                    </div>
                                    </div>
                                }

                            </div>

                        </div>
                    </div>
                    <!--Additions end-->
            
            
                    <!--review start-->
                    <div class="Review tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab" tabindex="0">
                        <div class="row">
                            @for (int i = 0; i < Model.productReviews.Count; i++)
                            {
                                <section class="border-2 border-light">
                                    <h3 class="username text-white mb-0 mt-4">@Model.productReviews[i].User_Name</h3>
                                    <label class="ratenum" style="color:#BE9C79">@Model.productReviews[i].Product_Rate out of 5</label>
                                    <p class="fs-4 "> @Model.productReviews[i].Product_Review</p>
                                    <hr class="text-white wider" />
                                </section>
                            }
                        </div>
                        <div id="respond" class="comment-respond mt-5">
                            <span id="reply-title" class="comment-reply-title fs-4">Add a review <small><a rel="nofollow" id="cancel-comment-reply-link" href="/product/french-press/#respond" style="display:none;">Cancel reply</a></small></span>
                            <form asp-controller="ProductDetails" asp-action="review" method="post" id="commentform" class="comment-form">
                                <div class="rate">
                                    <input class="invisible" type="radio" id="star1" name="rate" value="1" />
                                    <label id="1" for="star1" title="text" style="display: inline-block; font-size: 40px; color: #878787;">★</label>
                                    <input class="d-none" type="radio" id="star2" name="rate" value="2" />
                                    <label id="2" for="star2" title="text" style="display: inline-block; font-size: 40px; color: #878787;">★</label>
                                    <input class="d-none" type="radio" id="star3" name="rate" value="3" />
                                    <label id="3" for="star3" title="text" style="display: inline-block; font-size: 40px; color: #878787;">★</label>
                                    <input class="d-none" type="radio" id="star4" name="rate" value="4" />
                                    <label id="4" for="star4" title="text" style="display: inline-block; font-size: 40px; color: #878787;">★</label>
                                    <input class="d-none" type="radio" id="star5" name="rate" value="5" />
                                    <label id="5" for="star5" title="text" style="display: inline-block; font-size: 40px; color: #878787;">★</label>

                                </div>
                                <label class="d-block fs-4" for="message">Your review*</label>
                                <textarea class="border-whitform-control-feedback" id="message" name="review" rows="4" cols="50"></textarea>
                        <button class="btn btn-light d-block text-white p-3 mt-3 fs-5 rounded-1 form-control w-50 " style="background-color: #BE9C79;" type="submit" name="id" value="@Model.Product.Product_Id">Send Review</button>
                            </form>
                        </div>
                    </div>
                    <!--review end-->
                </div>
                <!--Tabs end-->
       
    </div>
@section scripts{
    <script src="~/js/bootstrap.bundle.js"></script>
    <script>

        /** set rating */
        let stars = document.getElementsByClassName("rate")[0].getElementsByTagName("label");
        let rate=0;
        console.log(stars);
        $(stars).hover(function () {
            let hovered = $(this).attr("id");
            for (var i = 0; i < hovered; i++) {
                $(stars[i]).attr("style", "font-size: 40px; color: #f9f21a")
            }
        }, function(){
            for (var i = rate; i < 5; i++) {
                $(stars[i]).attr("style", "font-size: 40px; color: #878787")
            }
        })
        $(stars).on("click", function () {
            for (var i = 0; i < 5; i++) {
                $(stars[i]).attr("style", "font-size: 40px; color: #878787")
            }
            rate = $(this).attr("id");
            for (var i = 0; i < rate; i++) {
                $(stars[i]).attr("style", "font-size: 40px; color: #f9f21a")
            }
        })

        $(".sizeLabel").on("click", function () {
            var size = $(this).html();
            console.log(this);
            if (size == "M")
                    $(".price").text(@Model.productSizePrices.Where(x => x.Size == 'M' && x.Product_Id == Model.Product.Product_Id).Select(p => p.Price.ToString("0.00")).FirstOrDefault()+" $");
            else if(size == "S")
                    $(".price").text(@Model.productSizePrices.Where(x => x.Size == 'S' && x.Product_Id == Model.Product.Product_Id).Select(p => p.Price.ToString("0.00")).FirstOrDefault()+" $");
            else
                    $(".price").text(@Model.productSizePrices.Where(x => x.Size == 'L' && x.Product_Id == Model.Product.Product_Id).Select(p => p.Price.ToString("0.00")).FirstOrDefault()+" $");

        })

        $(".additions").on("click", function () {
                
            var id = $(this).attr("id");
            console.log($(this).siblings("label").first());
            if (this.checked) { 
                $(this).siblings("label").html("<i class='fa-regular fa-trash-can fa-xl' style='color: #de1717; '></i>")
            }
            else
            {
                $(this).siblings("label").html("<i class='fa-regular fa-square-plus fa-xl' style='color:#1d9d1b'></i>")
            }
        })


        $(".addToCart").on("click", function () {
            console.log("buttonAddtoCart");
            var productId = @Model.Product.Product_Id; // Assuming you're passing the product ID to the view model
            var size = $('#sizeInput:checked').val(); // Assuming the size is selected from a dropdown
            var productAdds = [];
            $('.additions:checked').each(function () {
                productAdds.push($(this).val());
            });

                console.log(productId)
                console.log(size)
                console.log(productAdds)

        $.ajax({
            url: '@Url.Action("addProductToCart", "ProductDetails")',
            type: 'POST',
            data: {
                product: productId,
                size: size,
                productAdds: productAdds
            },
            success: function (result) {
                if (result.success) {
                    // Handle success, update UI, etc.
                    alert('Product added to cart successfully!');
                } else {
                    alert('Failed to add product to cart.');
                }
            },
            error: function () {
                alert('Error occurred while adding product to cart.');
            }
        });
    });
    </script>
    
}
