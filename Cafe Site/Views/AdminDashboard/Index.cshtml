@model IEnumerable<Cafe_Site.ViewModels.ProductInfoViewModel>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_CustomLayout.cshtml";
}

@* <h2>Index</h2> *@

<header id="fh5co-header" class="fh5co-cover js-fullheight" role="banner" style="background-image: url(/images/hero_1.jpeg);" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <div class="display-t js-fullheight">
                    <div class="display-tc js-fullheight animate-box" data-animate-effect="fadeIn">
                        <h1>Admin Dashboard</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="mt-4">
    <a asp-action="Add">Add Product</a>
</div>
<div class="container-fluid p-0" style="overflow:auto">
    <table class="table text-center text-light">
        <thead>
            <tr>
                <th style="text-align:center">
                    @Html.DisplayNameFor(model => model.Product_Name)
                </th>
                <th style="text-align:center">
                    @Html.DisplayNameFor(model => model.Product_Type)
                </th>
                <th style="text-align:center">
                    @Html.DisplayNameFor(model => model.Product_Quantity)
                </th>
                <th style="text-align:center">
                    @Html.DisplayNameFor(model => model.Product_Description)
                </th>
                <th style="text-align:center">
                    @Html.DisplayNameFor(model => model.SPrice)
                </th>
                <th style="text-align:center">
                    @Html.DisplayNameFor(model => model.MPrice)
                </th>
                <th style="text-align:center">
                    @Html.DisplayNameFor(model => model.LPrice)
                </th>
                <th style="text-align:center">
                    @Html.DisplayNameFor(model => model.Product_Image)
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr id="@item.Product_Id">
                    <td class="align-middle">
                        @Html.DisplayFor(modelItem => item.Product_Name)
                    </td>
                    <td class="align-middle">
                        @Html.DisplayFor(modelItem => item.Product_Type)
                    </td>
                    <td class="align-middle">
                        @Html.DisplayFor(modelItem => item.Product_Quantity)
                    </td>
                    <td class="align-middle">
                        @Html.DisplayFor(modelItem => item.Product_Description)
                    </td>
                    <td class="align-middle" id="S@(item.Product_Id)">
                        @Html.DisplayFor(modelItem => item.SPrice)
                    </td>
                    <td class="align-middle">
                        @Html.DisplayFor(modelItem => item.MPrice)
                    </td>
                    <td class="align-middle" id="L@(item.Product_Id)">
                        @Html.DisplayFor(modelItem => item.LPrice)
                    </td>
                    <td class="align-middle">
                        @* @Html.DisplayFor(modelItem => item.Product_Image) *@
                        <img src="data:image/png;base64,@item.Product_Image" alt="@item.Product_Name Image" style="height:50px">
                    </td>
                    <td class="align-middle">
                        @Html.ActionLink("Update", "Update", new { id = item.Product_Id }) |
                        <button type="button" class="bg-transparent text-danger border-0" onclick="ShowModal(@item.Product_Id)">Delete</button> |
                        <button type="button" class="bg-transparent text-danger border-0" onclick="ShowModalSize(@item.Product_Id)">Delete Size</button> |
                        @Html.ActionLink("View Order History", "GetOrdersHistory", new { id = item.Product_Id })
                        @* <a href="" onclick="ShowModal(@item.Product_Id)">Delete</a> *@
                        @* @Html.ActionLink("Delete", "Delete", "AdminDashboard", new { id = item.Product_Id }, new { onclick = $"ShowModal({item.Product_Id})" }) *@
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>


<!--Start Modal Section-->

<div class="modal fade" id="m1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Delete Confirmation</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-dark" id="ModalText"></div>
            <div class="modal-footer" id="mf">
                @*                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                <button type="button" class="btn btn-primary">Yes</button> *@
            </div>
        </div>
    </div>
</div>
<!-- End Modal Section-->

<!-- Start Modal 2 Section-->

<div class="modal fade" id="m2" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-dark" id="ModalText2">
            </div>
            <div class="modal-footer" id="mf2">
            </div>
        </div>
    </div>
</div>

<!-- End Modal 2 Section-->

@section scripts{
    <script>

        function loaded(){
            let adminnbl = document.getElementById('adminlink');

            adminnbl.className = "active";
        }

        loaded();

        function ShowModal(id) {
            let modal = new bootstrap.Modal(document.getElementById('m1'));

            let b1 = document.createElement("a");
            let b2 = document.createElement("a");

            b1.classList = "btn btn-secondary";

            b2.classList = "btn btn-primary";

            b1.innerText = "No";
            b2.innerText = "Yes";

            b1.setAttribute("data-bs-dismiss", "modal");
            b1.style.color = "white";
            b2.style.color = "white";
            b2.setAttribute("data-bs-dismiss", "modal");
            b2.onclick = DeleteProduct.bind(this, id);
            // b2.setAttribute("href", `/AdminDashboard/Delete/${id}`);

            let mf = document.getElementById('mf');

            let mt = document.getElementById('ModalText');

            mf.innerHTML = "";
            mt.innerText = "Are You Sure You Want To Delete This Product?";

            mf.append(b1, b2);

            modal.show();
        }

        function ShowModalSize(id) {
            let modal = new bootstrap.Modal(document.getElementById('m1'));

            let mf = document.getElementById('mf');

            let mt = document.getElementById('ModalText');

            let sp = document.getElementById(`S${id}`);
            let lp = document.getElementById(`L${id}`);
             
            mf.innerHTML = "";

            let b1 = document.createElement("a");
            b1.classList = "btn btn-secondary";
            b1.innerText = "Cancel";
            b1.setAttribute("data-bs-dismiss", "modal");
            b1.style.color = "white";

            mt.innerText = "Choose The Size You Want to Delete";

            if (sp.innerText != '-' && lp.innerText != '-') {
                let b2 = document.createElement("a");
                b2.classList = "btn btn-primary";
                b2.innerText = "Delete Size Small";
                b2.onclick = DeleteProductSize.bind(this, id, 'S');
                b2.setAttribute("data-bs-dismiss", "modal");
                b2.style.color = "white";

                // b2.setAttribute("href", `/AdminDashboard/DeleteSize/${id}?size=S`);

                let b3 = document.createElement("a");
                b3.classList = "btn btn-primary";
                b3.innerText = "Delete Size Large";
                b3.onclick = DeleteProductSize.bind(this, id, 'L');
                b3.setAttribute("data-bs-dismiss", "modal");
                b3.style.color = "white";

                // b3.setAttribute("href", `/AdminDashboard/DeleteSize/${id}?size=L`);

                // mt.innerText = "Choose The Size You Want to Delete";

                mf.append(b1, b2, b3);
            }
            else if (sp.innerText != '-') {
                let b2 = document.createElement("a");
                b2.classList = "btn btn-primary";
                b2.innerText = "Delete Size Small";
                b2.onclick = DeleteProductSize.bind(this, id, 'S');
                b2.setAttribute("data-bs-dismiss", "modal");
                b2.style.color = "white";

                // b2.setAttribute("href", `/AdminDashboard/DeleteSize/${id}?size=S`);

                // mt.innerText = "Choose The Size You Want to Delete";

                mf.append(b1, b2);
            }
            else if (lp.innerText != '-') {
                let b3 = document.createElement("a");
                b3.classList = "btn btn-primary";
                b3.innerText = "Delete Size Large";
                b3.onclick = DeleteProductSize.bind(this, id, 'L');
                b3.setAttribute("data-bs-dismiss", "modal");
                b3.style.color = "white";

                // b3.setAttribute("href", `/AdminDashboard/DeleteSize/${id}?size=L`);

                // mt.innerText = "Choose The Size You Want to Delete";

                mf.append(b1, b3);
            }
            else {
                b1.innerText = "Ok";

                mt.innerText = "There are no available sizes to be deleted";
                
                mf.append(b1);
            }
            // mt.innerText = "Choose The Size You Want to Delete";

            // mf.append(b1, b2, b3);

            modal.show();
        }

        function DeleteProduct(id){
            $.ajax({
                url: `/AdminDashboard/Delete/${id}`,
                type: "DELETE",
                dataType: "json",
                success: function (data) {

                    if(data.success){

                        let modal = new bootstrap.Modal(document.getElementById('m2'));

                        let b1 = document.createElement("a");

                        b1.classList = "btn btn-secondary";

                        b1.innerText = "Ok";

                        b1.setAttribute("data-bs-dismiss", "modal");
                        b1.style.color = "white";

                        let mf = document.getElementById('mf2');

                        let mt = document.getElementById('ModalText2');

                        let ml = document.getElementById('exampleModalLongTitle');

                        ml.innerText = "Deleted";

                        mt.innerHTML = "<div class='text-center'><img class='h-25 w-25' src='/images/checked.png' alt='' /><p class='text-dark mt-2'>Product Deleted Sucessfully!</p></div>";

                        mf.innerHTML = "";

                        mf.append(b1);

                        modal.show();

                        document.getElementById(`${id}`).remove();
                    } else {
                        let modal = new bootstrap.Modal(document.getElementById('m2'));

                        let b1 = document.createElement("a");

                        b1.classList = "btn btn-secondary";

                        b1.innerText = "Ok";

                        b1.setAttribute("data-bs-dismiss", "modal");
                        b1.style.color = "white";

                        let mf = document.getElementById('mf2');

                        let mt = document.getElementById('ModalText2');

                        let ml = document.getElementById('exampleModalLongTitle');

                        ml.innerText = "Error";

                        mt.innerHTML = "<div class='text-center'><img class='h-25 w-25' src='/images/cancel.png' alt='' /><p class='text-dark mt-2'>Deletion Failed!</p></div>";

                        mf.innerHTML = "";

                        mf.append(b1);

                        modal.show();
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        function DeleteProductSize(id, psize) {
            // console.log(psize);

            $.ajax({
                url: `/AdminDashboard/DeleteSize/${id}?size=${psize}`,
                type: "DELETE",
                dataType: "json",
                success: function (data) {

                    if(data.success){
                        let modal = new bootstrap.Modal(document.getElementById('m2'));

                        let b1 = document.createElement("a");

                        b1.classList = "btn btn-secondary";

                        b1.innerText = "Ok";

                        b1.setAttribute("data-bs-dismiss", "modal");
                        b1.style.color = "white";

                        let mf = document.getElementById('mf2');

                        let mt = document.getElementById('ModalText2');

                        let ml = document.getElementById('exampleModalLongTitle');

                        ml.innerText = "Deleted";

                        mt.innerHTML = "<div class='text-center'><img class='h-25 w-25' src='/images/checked.png' alt='' /><p class='text-dark mt-2'>Product Size Deleted Sucessfully!</p></div>";

                        mf.innerHTML = "";

                        mf.append(b1);

                        modal.show();

                        document.getElementById(`${psize}${id}`).innerText = '-';
                    }else{
                        let modal = new bootstrap.Modal(document.getElementById('m2'));

                        let b1 = document.createElement("a");

                        b1.classList = "btn btn-secondary";

                        b1.innerText = "Ok";

                        b1.setAttribute("data-bs-dismiss", "modal");
                        b1.style.color = "white";

                        let mf = document.getElementById('mf2');

                        let mt = document.getElementById('ModalText2');

                        let ml = document.getElementById('exampleModalLongTitle');

                        ml.innerText = "Error";

                        mt.innerHTML = "<div class='text-center'><img class='h-25 w-25' src='/images/cancel.png' alt='' /><p class='text-dark mt-2'>Deletion Failed!</p></div>";

                        mf.innerHTML = "";

                        mf.append(b1);

                        modal.show();

                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

    </script>
}